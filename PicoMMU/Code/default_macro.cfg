[gcode_macro CANCEL_PRINT]
description: Cancel the actual running print
rename_existing: CANCEL_PRINT_BASE
gcode:
        TURN_OFF_HEATERS
        CANCEL_PRINT_BASE

[gcode_macro M600]
gcode:
        PAUSE

[gcode_macro PAUSE]
description: Custom Ender3 macro Pause the actual running print
rename_existing: PAUSE_BASE
# change this if you need more or less extrusion
variable_extrude: 1.0
gcode:
        # save temps
        SET_GCODE_VARIABLE MACRO=_SP_VARS VARIABLE=resume_ext VALUE={printer.extruder.target}
        SET_GCODE_VARIABLE MACRO=_SP_VARS VARIABLE=resume_bed VALUE={printer.heater_bed.target}
        ##### read E from pause macro #####
        {% set E = printer["gcode_macro PAUSE"].extrude|float %}
        ##### set park positon for x and y #####
        # default is your max posion from your printer.cfg
        {% set x_park = 17 %}
        {% set y_park = 8 %}
        ##### calculate save lift position #####
        {% set act_z = printer.toolhead.position.z|float %}
        {% if act_z > 50 %}
                {% set z_safe = act_z %}
        {% else %}
                {% set z_safe = 50 %}
        {% endif %}
        ##### end of definitions #####
        PAUSE_BASE
        G91
        {% if printer.extruder.can_extrude|lower == 'true' %}
          G1 E-{E} F2100
        {% else %}
          {action_respond_info("Extruder not hot enough")}
        {% endif %}
        {% if "xyz" in printer.toolhead.homed_axes %}
          G1 Z{z_safe} F900
          G90
          G1 X{x_park} Y{y_park} F6000
        {% else %}
          {action_respond_info("Printer not homed")}
        {% endif %} 


[gcode_macro RESUME]
description: Stock Ender3 macro Resume the actual running print
rename_existing: RESUME_BASE
gcode:
        ##### read E from pause macro #####
        {% set E = printer["gcode_macro PAUSE"].extrude|float %}
        #### get VELOCITY parameter if specified ####
        {% if 'VELOCITY' in params|upper %}
          {% set get_params = ('VELOCITY=' + params.VELOCITY)  %}
        {%else %}
          {% set get_params = "" %}
        {% endif %}
        ##### end of definitions #####
        {% if printer.extruder.can_extrude|lower == 'true' %}
          G91
          G1 E{E} F2100
        {% else %}
          {action_respond_info("Extruder not hot enough")}
        {% endif %}  
        RESUME_BASE {get_params}
